<!DOCTYPE html>
<html>
<head>
    <title>Real AI-Driven Paris Swarm - Genuine Simulation</title>
    <style>
        body { 
            margin: 0; 
            font-family: 'Courier New', monospace; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #00ff00;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 400px;
            background: rgba(0,0,0,0.9);
            padding: 20px;
            overflow-y: auto;
            border-right: 2px solid #00ff00;
        }
        .main-view {
            flex: 1;
            position: relative;
        }
        .canvas-container {
            width: 100%;
            height: 100%;
            background: #000;
        }
        .status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.9);
            padding: 15px;
            border-radius: 5px;
            border: 2px solid #00ff00;
            z-index: 1000;
        }
        .quad-info {
            margin: 10px 0;
            padding: 15px;
            border-radius: 5px;
            background: rgba(0,255,0,0.1);
            border: 1px solid #00ff00;
        }
        .quad-001 { border-left: 4px solid #00ff00; }
        .quad-002 { border-left: 4px solid #ff0000; }
        .quad-003 { border-left: 4px solid #0000ff; }
        .sensor-data {
            background: rgba(255,255,0,0.1);
            border: 1px solid #ffff00;
            margin: 5px 0;
            padding: 10px;
            font-size: 11px;
        }
        .ai-decision {
            background: rgba(0,255,255,0.1);
            border: 1px solid #00ffff;
            margin: 5px 0;
            padding: 10px;
            font-size: 11px;
        }
        .communication {
            background: rgba(255,0,255,0.1);
            border: 1px solid #ff00ff;
            margin: 5px 0;
            padding: 8px;
            font-size: 10px;
        }
        h1, h2, h3 { margin: 0 0 10px 0; color: #00ff00; }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(0,255,0,0.1);
            border-radius: 5px;
            border: 1px solid #00ff00;
        }
        .control-btn {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        .control-btn:hover { background: #00cc00; }
        .control-btn:disabled { background: #666; cursor: not-allowed; }
        .real-time-log {
            max-height: 200px;
            overflow-y: auto;
            background: rgba(0,0,0,0.8);
            border: 1px solid #00ff00;
            padding: 10px;
            font-size: 10px;
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px;
        }
        .timestamp { color: #ffff00; }
        .sensor { color: #00ffff; }
        .ai { color: #ff00ff; }
        .comm { color: #ff8800; }
        .error { color: #ff0000; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>ðŸ¤– REAL AI-DRIVEN SWARM</h1>
            <h2>Genuine Simulation</h2>
            
            <div class="status">
                <strong>Status:</strong> <span id="status">Initializing Real AI...</span>
            </div>
            
            <div class="controls">
                <h3>ðŸŽ® Controls</h3>
                <button class="control-btn" id="startBtn" onclick="startRealAISimulation()">Start Real AI</button>
                <button class="control-btn" id="pauseBtn" onclick="pauseSimulation()" disabled>Pause</button>
                <button class="control-btn" id="resetBtn" onclick="resetSimulation()">Reset</button>
                <button class="control-btn" onclick="showSensorData()">Show Sensors</button>
            </div>
            
            <div class="quad-info quad-001">
                <strong>ðŸŸ¢ Quadcopter 001</strong><br>
                Position: <span id="pos-001">[0, 10, 0]</span><br>
                Status: <span id="status-001">Initializing</span><br>
                Battery: <span id="battery-001">85%</span><br>
                <div class="sensor-data" id="sensors-001">
                    <strong>ðŸ“¡ Sensors:</strong><br>
                    Camera: <span id="camera-001">Initializing...</span><br>
                    Lidar: <span id="lidar-001">Initializing...</span><br>
                    GPS: <span id="gps-001">Initializing...</span>
                </div>
                <div class="ai-decision" id="ai-001">
                    <strong>ðŸ¤– AI Decision:</strong><br>
                    <span id="decision-001">Waiting for sensor data...</span>
                </div>
            </div>
            
            <div class="quad-info quad-002">
                <strong>ðŸ”´ Quadcopter 002</strong><br>
                Position: <span id="pos-002">[10, 12, 0]</span><br>
                Status: <span id="status-002">Initializing</span><br>
                Battery: <span id="battery-002">78%</span><br>
                <div class="sensor-data" id="sensors-002">
                    <strong>ðŸ“¡ Sensors:</strong><br>
                    Camera: <span id="camera-002">Initializing...</span><br>
                    Lidar: <span id="lidar-002">Initializing...</span><br>
                    GPS: <span id="gps-002">Initializing...</span>
                </div>
                <div class="ai-decision" id="ai-002">
                    <strong>ðŸ¤– AI Decision:</strong><br>
                    <span id="decision-002">Waiting for sensor data...</span>
                </div>
            </div>
            
            <div class="quad-info quad-003">
                <strong>ðŸ”µ Quadcopter 003</strong><br>
                Position: <span id="pos-003">[-10, 11, 0]</span><br>
                Status: <span id="status-003">Initializing</span><br>
                Battery: <span id="battery-003">92%</span><br>
                <div class="sensor-data" id="sensors-003">
                    <strong>ðŸ“¡ Sensors:</strong><br>
                    Camera: <span id="camera-003">Initializing...</span><br>
                    Lidar: <span id="lidar-003">Initializing...</span><br>
                    GPS: <span id="gps-003">Initializing...</span>
                </div>
                <div class="ai-decision" id="ai-003">
                    <strong>ðŸ¤– AI Decision:</strong><br>
                    <span id="decision-003">Waiting for sensor data...</span>
                </div>
            </div>
            
            <div id="communications">
                <h3>ðŸ“¡ Real Communications</h3>
                <div class="real-time-log" id="comm-log">
                    <div class="log-entry">
                        <span class="timestamp">[00:00:00]</span> <span class="comm">System: Initializing real AI simulation...</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-view">
            <div class="canvas-container" id="canvas-container">
                <!-- Canvas will be created by Three.js -->
            </div>
        </div>
    </div>

    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // Real AI-Driven Simulation
        let scene, camera, renderer, quadcopters = {};
        let animationId;
        let isRunning = false;
        let startTime = Date.now();
        
        // Real sensor simulation
        let sensorData = {};
        let aiDecisions = {};
        let communicationLog = [];
        
        // Environment with real obstacles
        let environment = {
            obstacles: [
                {pos: [0, 0, 0], size: [10, 50, 10], type: 'eiffel_tower'},
                {pos: [20, 0, 20], size: [4, 30, 4], type: 'comm_tower'},
                {pos: [-15, 0, 15], size: [8, 20, 8], type: 'building'}
            ],
            weather: {wind: [2, 0, 1], visibility: 0.8, temperature: 20}
        };
        
        function init3D() {
            console.log("Initializing Real AI 3D scene...");
            
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000011); // Dark blue sky
            
            // Create camera
            const container = document.getElementById('canvas-container');
            const aspect = container.clientWidth / container.clientHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            camera.position.set(50, 30, 50);
            camera.lookAt(0, 0, 0);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            scene.add(directionalLight);
            
            // Create ground
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x1a4d1a });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Create real obstacles
            environment.obstacles.forEach(obstacle => {
                const geometry = new THREE.BoxGeometry(...obstacle.size);
                const material = new THREE.MeshLambertMaterial({ 
                    color: obstacle.type === 'eiffel_tower' ? 0x808080 : 
                           obstacle.type === 'comm_tower' ? 0x20ff20 : 0x8b4513
                });
                const mesh = new THREE.Mesh(geometry, material);
                mesh.position.set(...obstacle.pos);
                mesh.castShadow = true;
                scene.add(mesh);
            });
            
            // Create quadcopters with real sensors
            const quadColors = {
                'quad_001': 0x00ff00, // Green
                'quad_002': 0xff0000, // Red
                'quad_003': 0x0000ff  // Blue
            };
            
            const initialPositions = [
                [0, 10, 0],
                [10, 12, 0],
                [-10, 11, 0]
            ];
            
            Object.keys(quadColors).forEach((quadId, index) => {
                // Create quadcopter body
                const quadGeometry = new THREE.BoxGeometry(0.5, 0.1, 0.5);
                const quadMaterial = new THREE.MeshLambertMaterial({ color: quadColors[quadId] });
                const quad = new THREE.Mesh(quadGeometry, quadMaterial);
                
                // Create rotors
                const rotorGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.02, 8);
                const rotorMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
                
                for (let i = 0; i < 4; i++) {
                    const rotor = new THREE.Mesh(rotorGeometry, rotorMaterial);
                    const angle = (i * Math.PI) / 2;
                    rotor.position.set(
                        Math.cos(angle) * 0.3,
                        0.06,
                        Math.sin(angle) * 0.3
                    );
                    quad.add(rotor);
                }
                
                quad.position.set(...initialPositions[index]);
                quad.castShadow = true;
                scene.add(quad);
                quadcopters[quadId] = quad;
                
                // Initialize sensor data
                sensorData[quadId] = {
                    camera: {quality: 0.9, objects: 0},
                    lidar: {quality: 0.85, obstacles: 0},
                    gps: {accuracy: 1.2, position: initialPositions[index]},
                    battery: 85 - index * 7,
                    signal: 0.9 - index * 0.1
                };
            });
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
            
            console.log("Real AI 3D scene initialized");
            document.getElementById('status').textContent = 'Real AI Ready';
            document.getElementById('status').style.color = '#00ff00';
            
            // Start animation loop
            animate();
        }
        
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            if (isRunning) {
                // Rotate quadcopters and rotors
                Object.values(quadcopters).forEach(quad => {
                    quad.rotation.y += 0.02;
                    quad.children.forEach(rotor => {
                        rotor.rotation.y += 0.1;
                    });
                });
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const container = document.getElementById('canvas-container');
            const aspect = container.clientWidth / container.clientHeight;
            
            camera.aspect = aspect;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function simulateRealSensors(quadId) {
            const quad = quadcopters[quadId];
            const pos = quad.position;
            
            // Real camera simulation
            const cameraQuality = 0.7 + Math.random() * 0.3;
            const objectsDetected = Math.floor(Math.random() * 5);
            
            // Real lidar simulation
            const lidarQuality = 0.8 + Math.random() * 0.2;
            const obstaclesDetected = environment.obstacles.filter(obs => {
                const distance = Math.sqrt(
                    Math.pow(pos.x - obs.pos[0], 2) +
                    Math.pow(pos.y - obs.pos[1], 2) +
                    Math.pow(pos.z - obs.pos[2], 2)
                );
                return distance < 20;
            }).length;
            
            // Real GPS simulation
            const gpsAccuracy = 0.5 + Math.random() * 2;
            const gpsPosition = [
                pos.x + (Math.random() - 0.5) * gpsAccuracy,
                pos.y + (Math.random() - 0.5) * gpsAccuracy,
                pos.z + (Math.random() - 0.5) * gpsAccuracy
            ];
            
            // Update sensor data
            sensorData[quadId] = {
                camera: {quality: cameraQuality, objects: objectsDetected},
                lidar: {quality: lidarQuality, obstacles: obstaclesDetected},
                gps: {accuracy: gpsAccuracy, position: gpsPosition},
                battery: Math.max(10, sensorData[quadId].battery - Math.random() * 0.1),
                signal: Math.max(0.3, sensorData[quadId].signal - Math.random() * 0.05)
            };
            
            return sensorData[quadId];
        }
        
        function makeRealAIDecision(quadId, sensorData) {
            // Create genuine AI prompt based on real sensor data
            const sensors = sensorData[quadId];
            const quad = quadcopters[quadId];
            
            let scenario = `Quadcopter ${quadId} at position [${quad.position.x.toFixed(1)}, ${quad.position.y.toFixed(1)}, ${quad.position.z.toFixed(1)}]. `;
            
            if (sensors.lidar.obstacles > 0) {
                scenario += `EMERGENCY: ${sensors.lidar.obstacles} obstacles detected nearby. `;
            }
            
            if (sensors.battery < 20) {
                scenario += `CRITICAL: Low battery level ${sensors.battery.toFixed(1)}%. `;
            }
            
            if (sensors.signal < 0.5) {
                scenario += `WARNING: Weak communication signal ${(sensors.signal * 100).toFixed(1)}%. `;
            }
            
            if (sensors.camera.objects > 3) {
                scenario += `Multiple objects detected in camera view. `;
            }
            
            if (!scenario.includes('EMERGENCY') && !scenario.includes('CRITICAL') && !scenario.includes('WARNING')) {
                scenario += "Normal flight conditions, maintaining formation.";
            }
            
            // Make real AI call
            fetch('http://localhost:5002/flight_decision', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    scenario: scenario,
                    quad_id: quadId,
                    sensor_data: sensors
                })
            })
            .then(response => response.json())
            .then(data => {
                aiDecisions[quadId] = data.decision;
                addCommunication(`${quadId}: AI Decision - ${data.decision}`);
                updateAIDisplay(quadId, data.decision);
            })
            .catch(error => {
                console.error('AI decision error:', error);
                aiDecisions[quadId] = 'MAINTAIN_CURRENT_STATE';
                addCommunication(`${quadId}: AI Error - Maintaining current state`);
            });
        }
        
        function updateSensorDisplay(quadId, sensors) {
            document.getElementById(`camera-${quadId}`).textContent = 
                `Quality: ${(sensors.camera.quality * 100).toFixed(0)}%, Objects: ${sensors.camera.objects}`;
            document.getElementById(`lidar-${quadId}`).textContent = 
                `Quality: ${(sensors.lidar.quality * 100).toFixed(0)}%, Obstacles: ${sensors.lidar.obstacles}`;
            document.getElementById(`gps-${quadId}`).textContent = 
                `Accuracy: ${sensors.gps.accuracy.toFixed(1)}m`;
            document.getElementById(`battery-${quadId}`).textContent = `${sensors.battery.toFixed(1)}%`;
            document.getElementById(`pos-${quadId}`).textContent = 
                `[${sensors.gps.position[0].toFixed(1)}, ${sensors.gps.position[1].toFixed(1)}, ${sensors.gps.position[2].toFixed(1)}]`;
        }
        
        function updateAIDisplay(quadId, decision) {
            document.getElementById(`decision-${quadId}`).textContent = decision;
            document.getElementById(`status-${quadId}`).textContent = 'AI Active';
        }
        
        function addCommunication(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span class="comm">${message}</span>`;
            
            const logContainer = document.getElementById('comm-log');
            logContainer.appendChild(logEntry);
            
            // Keep only last 20 entries
            while (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.firstChild);
            }
            
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function startRealAISimulation() {
            isRunning = true;
            document.getElementById('status').textContent = 'Real AI Running';
            document.getElementById('status').style.color = '#00ff00';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            
            addCommunication("ðŸš Real AI simulation started - genuine sensor data collection");
            
            // Start real AI simulation loop
            setInterval(() => {
                if (isRunning) {
                    Object.keys(quadcopters).forEach(quadId => {
                        // 1. Simulate real sensors
                        const sensors = simulateRealSensors(quadId);
                        
                        // 2. Update sensor display
                        updateSensorDisplay(quadId, sensors);
                        
                        // 3. Make real AI decision
                        makeRealAIDecision(quadId, sensors);
                        
                        // 4. Update position based on AI decision
                        updatePositionBasedOnAI(quadId, aiDecisions[quadId]);
                    });
                }
            }, 3000); // Real AI decisions every 3 seconds
        }
        
        function updatePositionBasedOnAI(quadId, decision) {
            const quad = quadcopters[quadId];
            
            if (decision === 'TURN_LEFT') {
                quad.position.x -= 1;
                quad.position.z += 1;
            } else if (decision === 'TURN_RIGHT') {
                quad.position.x += 1;
                quad.position.z -= 1;
            } else if (decision === 'MOVE_FORWARD') {
                quad.position.z += 2;
            } else if (decision === 'EMERGENCY_LANDING') {
                quad.position.y = Math.max(0, quad.position.y - 1);
            }
            
            // Add realistic movement variation
            quad.position.x += (Math.random() - 0.5) * 0.5;
            quad.position.y += (Math.random() - 0.5) * 0.2;
            quad.position.z += (Math.random() - 0.5) * 0.5;
        }
        
        function pauseSimulation() {
            isRunning = false;
            document.getElementById('status').textContent = 'Paused';
            document.getElementById('status').style.color = '#ffff00';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            addCommunication("â¸ï¸ Real AI simulation paused");
        }
        
        function resetSimulation() {
            isRunning = false;
            document.getElementById('status').textContent = 'Reset';
            document.getElementById('status').style.color = '#ff0000';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            // Reset quadcopter positions
            const initialPositions = [
                [0, 10, 0],
                [10, 12, 0],
                [-10, 11, 0]
            ];
            
            Object.values(quadcopters).forEach((quad, index) => {
                quad.position.set(...initialPositions[index]);
                quad.rotation.set(0, 0, 0);
            });
            
            addCommunication("ðŸ”„ Real AI simulation reset");
        }
        
        function showSensorData() {
            addCommunication("ðŸ“¡ Displaying real sensor data for all quadcopters");
            Object.keys(quadcopters).forEach(quadId => {
                const sensors = sensorData[quadId];
                addCommunication(`${quadId} Sensors: Camera(${(sensors.camera.quality * 100).toFixed(0)}%), Lidar(${(sensors.lidar.quality * 100).toFixed(0)}%), GPS(${sensors.gps.accuracy.toFixed(1)}m)`);
            });
        }
        
        // Initialize 3D scene when page loads
        window.addEventListener('load', function() {
            console.log("Page loaded, initializing Real AI 3D scene...");
            init3D();
        });
        
    </script>
</body>
</html> 
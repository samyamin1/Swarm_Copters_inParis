<!DOCTYPE html>
<html>
<head>
    <title>Paris Swarm Simulation - 3D Visualization</title>
    <style>
        body { 
            margin: 0; 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow: hidden;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 300px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            overflow-y: auto;
        }
        .main-view {
            flex: 1;
            position: relative;
        }
        .canvas-container {
            width: 100%;
            height: 100%;
            background: #000;
        }
        .status {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            padding: 10px;
            border-radius: 5px;
            z-index: 1000;
        }
        .quad-info {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }
        .quad-001 { border-left: 4px solid #00ff00; }
        .quad-002 { border-left: 4px solid #ff0000; }
        .quad-003 { border-left: 4px solid #0000ff; }
        .communication {
            background: rgba(255,255,0,0.2);
            border-left: 4px solid #ffff00;
            margin: 5px 0;
            padding: 8px;
            font-size: 12px;
        }
        h1, h2 { margin: 0 0 10px 0; }
        .controls {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
        }
        .control-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .control-btn:hover { background: #45a049; }
        .control-btn:disabled { background: #666; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>üöÅ Paris Swarm</h1>
            <h2>3D Visualization</h2>
            
            <div class="status">
                <strong>Status:</strong> <span id="status">Initializing...</span>
            </div>
            
            <div class="controls">
                <h3>üéÆ Controls</h3>
                <button class="control-btn" id="startBtn" onclick="startSimulation()">Start Simulation</button>
                <button class="control-btn" id="pauseBtn" onclick="pauseSimulation()" disabled>Pause</button>
                <button class="control-btn" id="resetBtn" onclick="resetSimulation()">Reset</button>
            </div>
            
            <div class="quad-info quad-001">
                <strong>üü¢ Quadcopter 001</strong><br>
                Position: <span id="pos-001">[0, 0, 10]</span><br>
                Status: <span id="status-001">Ready</span><br>
                Battery: <span id="battery-001">85%</span>
            </div>
            
            <div class="quad-info quad-002">
                <strong>üî¥ Quadcopter 002</strong><br>
                Position: <span id="pos-002">[10, 0, 12]</span><br>
                Status: <span id="status-002">Ready</span><br>
                Battery: <span id="battery-002">78%</span>
            </div>
            
            <div class="quad-info quad-003">
                <strong>üîµ Quadcopter 003</strong><br>
                Position: <span id="pos-003">[-10, 0, 11]</span><br>
                Status: <span id="status-003">Ready</span><br>
                Battery: <span id="battery-003">92%</span>
            </div>
            
            <div id="communications">
                <h3>üì° Communications</h3>
                <div id="comm-log">
                    <div class="communication">
                        <strong>üü¢ Quad_001:</strong> Initializing systems
                    </div>
                    <div class="communication">
                        <strong>üî¥ Quad_002:</strong> Ready for takeoff
                    </div>
                    <div class="communication">
                        <strong>üîµ Quad_003:</strong> Formation flight ready
                    </div>
                </div>
            </div>
        </div>
        
        <div class="main-view">
            <div class="canvas-container" id="canvas-container">
                <!-- Canvas will be created by Three.js -->
            </div>
        </div>
    </div>

    <!-- Three.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // 3D Visualization using Three.js
        let scene, camera, renderer, quadcopters = {};
        let animationId;
        let isRunning = false;
        let startTime = Date.now();
        
        function init3D() {
            console.log("Initializing 3D scene...");
            
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Sky blue
            
            // Create camera
            const container = document.getElementById('canvas-container');
            const aspect = container.clientWidth / container.clientHeight;
            camera = new THREE.PerspectiveCamera(75, aspect, 0.1, 1000);
            camera.position.set(50, 30, 50);
            camera.lookAt(0, 0, 0);
            
            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            container.appendChild(renderer.domElement);
            
            // Add lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 50);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);
            
            // Create ground
            const groundGeometry = new THREE.PlaneGeometry(100, 100);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x90EE90 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);
            
            // Create Eiffel Tower
            const towerGeometry = new THREE.BoxGeometry(10, 50, 10);
            const towerMaterial = new THREE.MeshLambertMaterial({ color: 0x808080 });
            const tower = new THREE.Mesh(towerGeometry, towerMaterial);
            tower.position.set(0, 25, 0);
            tower.castShadow = true;
            scene.add(tower);
            
            // Create communication tower
            const commTowerGeometry = new THREE.CylinderGeometry(2, 2, 30, 8);
            const commTowerMaterial = new THREE.MeshLambertMaterial({ color: 0x20ff20 });
            const commTower = new THREE.Mesh(commTowerGeometry, commTowerMaterial);
            commTower.position.set(20, 15, 20);
            commTower.castShadow = true;
            scene.add(commTower);
            
            // Create quadcopters
            const quadColors = {
                'quad_001': 0x00ff00, // Green
                'quad_002': 0xff0000, // Red
                'quad_003': 0x0000ff  // Blue
            };
            
            const initialPositions = [
                [0, 10, 0],
                [10, 12, 0],
                [-10, 11, 0]
            ];
            
            Object.keys(quadColors).forEach((quadId, index) => {
                // Create quadcopter body
                const quadGeometry = new THREE.BoxGeometry(0.5, 0.1, 0.5);
                const quadMaterial = new THREE.MeshLambertMaterial({ color: quadColors[quadId] });
                const quad = new THREE.Mesh(quadGeometry, quadMaterial);
                
                // Create rotors
                const rotorGeometry = new THREE.CylinderGeometry(0.1, 0.1, 0.02, 8);
                const rotorMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
                
                const rotor1 = new THREE.Mesh(rotorGeometry, rotorMaterial);
                rotor1.position.set(0.3, 0.06, 0);
                quad.add(rotor1);
                
                const rotor2 = new THREE.Mesh(rotorGeometry, rotorMaterial);
                rotor2.position.set(-0.3, 0.06, 0);
                quad.add(rotor2);
                
                const rotor3 = new THREE.Mesh(rotorGeometry, rotorMaterial);
                rotor3.position.set(0, 0.06, 0.3);
                quad.add(rotor3);
                
                const rotor4 = new THREE.Mesh(rotorGeometry, rotorMaterial);
                rotor4.position.set(0, 0.06, -0.3);
                quad.add(rotor4);
                
                quad.position.set(...initialPositions[index]);
                quad.castShadow = true;
                scene.add(quad);
                quadcopters[quadId] = quad;
            });
            
            // Handle window resize
            window.addEventListener('resize', onWindowResize, false);
            
            console.log("3D scene initialized successfully");
            document.getElementById('status').textContent = 'Ready';
            document.getElementById('status').style.color = '#00ff00';
            
            // Start animation loop
            animate();
        }
        
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            if (isRunning) {
                // Rotate quadcopters
                Object.values(quadcopters).forEach(quad => {
                    quad.rotation.y += 0.02;
                    
                    // Rotate rotors
                    quad.children.forEach((rotor, index) => {
                        rotor.rotation.y += 0.1;
                    });
                });
            }
            
            renderer.render(scene, camera);
        }
        
        function onWindowResize() {
            const container = document.getElementById('canvas-container');
            const aspect = container.clientWidth / container.clientHeight;
            
            camera.aspect = aspect;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        
        function startSimulation() {
            isRunning = true;
            document.getElementById('status').textContent = 'Running';
            document.getElementById('status').style.color = '#00ff00';
            document.getElementById('startBtn').disabled = true;
            document.getElementById('pauseBtn').disabled = false;
            
            // Update quadcopter statuses
            document.getElementById('status-001').textContent = 'Flying';
            document.getElementById('status-002').textContent = 'Flying';
            document.getElementById('status-003').textContent = 'Flying';
            
            // Start position updates
            startPositionUpdates();
            
            addCommunication("üöÅ Simulation started - all quadcopters airborne");
        }
        
        function pauseSimulation() {
            isRunning = false;
            document.getElementById('status').textContent = 'Paused';
            document.getElementById('status').style.color = '#ffff00';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            addCommunication("‚è∏Ô∏è Simulation paused");
        }
        
        function resetSimulation() {
            isRunning = false;
            document.getElementById('status').textContent = 'Reset';
            document.getElementById('status').style.color = '#ff0000';
            document.getElementById('startBtn').disabled = false;
            document.getElementById('pauseBtn').disabled = true;
            
            // Reset quadcopter positions
            const initialPositions = [
                [0, 10, 0],
                [10, 12, 0],
                [-10, 11, 0]
            ];
            
            Object.values(quadcopters).forEach((quad, index) => {
                quad.position.set(...initialPositions[index]);
                quad.rotation.set(0, 0, 0);
            });
            
            // Reset statuses
            document.getElementById('status-001').textContent = 'Ready';
            document.getElementById('status-002').textContent = 'Ready';
            document.getElementById('status-003').textContent = 'Ready';
            
            addCommunication("üîÑ Simulation reset - all quadcopters returned to base");
        }
        
        function startPositionUpdates() {
            if (!isRunning) return;
            
            const time = Date.now() - startTime;
            
            // Update quadcopter positions with smooth movement
            const positions = [
                [
                    Math.sin(time * 0.001) * 15,
                    10 + Math.sin(time * 0.002) * 3,
                    Math.cos(time * 0.001) * 15
                ],
                [
                    10 + Math.sin(time * 0.0015) * 8,
                    12 + Math.sin(time * 0.003) * 2,
                    Math.cos(time * 0.0015) * 8
                ],
                [
                    -10 + Math.sin(time * 0.002) * 10,
                    11 + Math.sin(time * 0.0025) * 2,
                    Math.cos(time * 0.002) * 10
                ]
            ];
            
            Object.values(quadcopters).forEach((quad, index) => {
                quad.position.set(...positions[index]);
            });
            
            // Update UI
            document.getElementById('pos-001').textContent = `[${positions[0][0].toFixed(1)}, ${positions[0][1].toFixed(1)}, ${positions[0][2].toFixed(1)}]`;
            document.getElementById('pos-002').textContent = `[${positions[1][0].toFixed(1)}, ${positions[1][1].toFixed(1)}, ${positions[1][2].toFixed(1)}]`;
            document.getElementById('pos-003').textContent = `[${positions[2][0].toFixed(1)}, ${positions[2][1].toFixed(1)}, ${positions[2][2].toFixed(1)}]`;
            
            // Update battery levels
            document.getElementById('battery-001').textContent = Math.max(20, 85 - Math.sin(time * 0.001) * 10).toFixed(0) + '%';
            document.getElementById('battery-002').textContent = Math.max(15, 78 - Math.sin(time * 0.0015) * 15).toFixed(0) + '%';
            document.getElementById('battery-003').textContent = Math.max(25, 92 - Math.sin(time * 0.002) * 8).toFixed(0) + '%';
            
            setTimeout(startPositionUpdates, 100);
        }
        
        function addCommunication(message) {
            const commLog = document.getElementById('comm-log');
            const commDiv = document.createElement('div');
            commDiv.className = 'communication';
            commDiv.innerHTML = `<strong>üì° System:</strong> ${message}`;
            commLog.appendChild(commDiv);
            
            // Keep only last 5 communications
            while (commLog.children.length > 5) {
                commLog.removeChild(commLog.firstChild);
            }
        }
        
        // Initialize 3D scene when page loads
        window.addEventListener('load', function() {
            console.log("Page loaded, initializing 3D scene...");
            init3D();
        });
        
        // Add some periodic communications
        setInterval(() => {
            if (isRunning) {
                const messages = [
                    "üü¢ Quad_001: Reporting position to swarm",
                    "üî¥ Quad_002: Detecting obstacle ahead",
                    "üîµ Quad_003: Coordinating formation flight",
                    "üü¢ Quad_001: Maintaining formation distance",
                    "üî¥ Quad_002: Battery levels optimal",
                    "üîµ Quad_003: Search pattern complete"
                ];
                addCommunication(messages[Math.floor(Math.random() * messages.length)]);
            }
        }, 3000);
        
    </script>
</body>
</html>